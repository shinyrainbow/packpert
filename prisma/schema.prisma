generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Product category enum based on catalog submenu
enum ProductCategory {
  foilPouch
  cosmeticTube
  paperBox
  plasticBottle
  label
  customBox
}

// Blog/Article status
enum PublishStatus {
  draft
  published
  archived
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  articles  Article[]
}

model Contact {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  company   String?
  subject   String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Enhanced Product model for catalog
model Product {
  id            String   @id @default(cuid())
  name          String
  nameTh        String
  slug          String?  // Made optional for migration
  description   String?  @db.Text
  descriptionTh String?  @db.Text
  category      String   // Keep as String for now (matches existing data)

  // Product details
  minOrder      Int?            // Minimum order quantity
  material      String?         // e.g., "Aluminum Foil", "PET", "Kraft Paper"
  materialTh    String?
  sizes         String?         // Available sizes (JSON string or comma-separated)
  sizesTh       String?
  features      String?         @db.Text // Key features
  featuresTh    String?         @db.Text

  // Images
  image         String?         // Main image URL
  images        ProductImage[]  // Multiple product images

  // Display settings
  isFeatured    Boolean         @default(false)
  isActive      Boolean         @default(true)
  sortOrder     Int             @default(0)

  // SEO
  metaTitle     String?
  metaTitleTh   String?
  metaDesc      String?
  metaDescTh    String?

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([category])
  @@index([isFeatured])
  @@index([isActive])
}

// Product images for gallery
model ProductImage {
  id        String   @id @default(cuid())
  url       String
  alt       String?
  altTh     String?
  sortOrder Int      @default(0)
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@index([productId])
}

// Blog/Article model
model Article {
  id            String        @id @default(cuid())
  title         String
  titleTh       String
  slug          String        @unique
  excerpt       String?       @db.Text // Short summary
  excerptTh     String?       @db.Text
  content       String        @db.Text // Full article content (HTML or Markdown)
  contentTh     String        @db.Text

  // Media
  featuredImage String?       // Main article image

  // Categorization
  category      String?       // Article category (e.g., "packaging-tips", "industry-news")
  tags          ArticleTag[]  // Many-to-many with tags

  // Publishing
  status        PublishStatus @default(draft)
  publishedAt   DateTime?

  // Author
  authorId      String?
  author        User?         @relation(fields: [authorId], references: [id], onDelete: SetNull)

  // Engagement
  viewCount     Int           @default(0)

  // SEO
  metaTitle     String?
  metaTitleTh   String?
  metaDesc      String?
  metaDescTh    String?

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([status])
  @@index([category])
  @@index([publishedAt])
  @@index([authorId])
}

// Tags for articles
model Tag {
  id        String       @id @default(cuid())
  name      String       @unique
  nameTh    String
  slug      String       @unique
  articles  ArticleTag[]
  createdAt DateTime     @default(now())
}

// Junction table for Article-Tag many-to-many
model ArticleTag {
  articleId String
  tagId     String
  article   Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  tag       Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([articleId, tagId])
  @@index([articleId])
  @@index([tagId])
}

model Portfolio {
  id            String   @id @default(cuid())
  title         String
  titleTh       String
  slug          String?  // Made optional for migration
  description   String?  @db.Text
  descriptionTh String?  @db.Text
  image         String
  images        String?  // Additional images (JSON array)
  client        String?
  category      String?  // e.g., "cosmetics", "food", "retail"
  isFeatured    Boolean  @default(false)
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([isFeatured])
  @@index([category])
}

// Blog model with sections
model Blog {
  id          String        @id @default(cuid())
  title       String        // Thai title (default)
  titleEn     String?       // English title
  slug        String        @unique
  excerpt     String?       @db.Text
  excerptEn   String?       @db.Text
  coverImage  String?
  isPublished Boolean       @default(false)
  publishedAt DateTime?
  viewCount   Int           @default(0)

  // Relations
  sections    BlogSection[]
  categoryId  String?
  category    BlogCategory? @relation(fields: [categoryId], references: [id])

  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([isPublished])
  @@index([publishedAt])
  @@index([categoryId])
}

// Blog content sections
model BlogSection {
  id        String   @id @default(cuid())
  order     Int      @default(0)
  imageUrl  String?
  content   String?  @db.Text // Thai content (default)
  contentEn String?  @db.Text // English content

  blogId    String
  blog      Blog     @relation(fields: [blogId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([blogId])
}

// Blog categories
model BlogCategory {
  id      String  @id @default(cuid())
  name    String  // Thai name (default)
  nameEn  String? // English name
  slug    String  @unique
  color   String  @default("#C9A227")

  blogs   Blog[]

  createdAt DateTime @default(now())
}
